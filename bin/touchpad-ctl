#!/bin/sh
#
# Enables the touchpad if and only if there aren't any external mice connected.
#
# Originally from:
#
#     https://wiki.archlinux.org/index.php/Touchpad_Synaptics#System_with_multiple_X_sessions
#
# INSTRUCTIONS
# ============
#
# Set TOUCHPAD according to your configuration.  To find out:
#
#     find /sys/class/input/ -name "mouse*" -exec udevadm info -a {} \; \
#         | grep "ATTRS{name}"
#

TOUCHPAD="SynPS/2 Synaptics TouchPad"

FOUND=0
MICE=$(find /sys/class/input -name "mouse*")
for MOUSE in $MICE
do
    if [ "$(cat $MOUSE/device/name)" != "$TOUCHPAD" ]
    then
	FOUND=1
	break
    fi
done

export DISPLAY=:0
USERS=$(w -h | cut -d' ' -f1 | sort | uniq)
for USER in $USERS
do
    export XAUTHORITY=$(sudo -Hiu $USER env | grep -e "^HOME=" | cut -d'=' -f2)/.Xauthority
    synclient TouchpadOff=$FOUND
done
