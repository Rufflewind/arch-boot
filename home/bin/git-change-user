#!/bin/sh
# Changes the user of all Git commits with OLD_NAME to commits with NEW_NAME
# and NEW_EMAIL.
#
# Usage: git-change-user OLD_NAME NEW_NAME NEW_EMAIL

[ "$1" ] && [ "$2" ] && [ "$3" ] || {
    echo >&2 "Usage: $0 OLD_NAME NEW_NAME NEW_EMAIL"
    exit 1
}

OLD_NAME="$1"
NEW_NAME="$2"
NEW_EMAIL="$3"

git filter-branch -f --commit-filter "
    if [ \"\$GIT_COMMITTER_NAME\" = \"$OLD_NAME\" ]
    then
        GIT_COMMITTER_NAME=\"$NEW_NAME\"
        GIT_COMMITTER_EMAIL=\"$NEW_EMAIL\"
    fi
    if [ \"\$GIT_AUTHOR_NAME\" = \"$OLD_NAME\" ]
    then
        GIT_AUTHOR_NAME=\"$NEW_NAME\"
        GIT_AUTHOR_EMAIL=\"$NEW_EMAIL\"
    fi
    git commit-tree \"\$@\"" HEAD
git update-index -q --ignore-submodules --refresh
